1


Select m.meter_number,b.owner_name,b.address,b.contact_number,bt.name,e.connection_name
from meter m 
JOIN building b on m.building_id=b.id
JOIN building_type bt on b.building_type_id=bt.id
JOIN electricity_connection_type e on bt.connection_type_id=e.id
order by b.owner_name,m.meter_number;

2

Select building.owner_name,building.address,count(*) as connection_count from building
INNER JOIN building_type on building.building_type_id=building_type.id
INNER JOIN electricity_connection_type c on c.id=building_type.connection_type_id
INNER JOIN meter on meter.building_id=building.id
Group by building.id
Order  by building.owner_name ASC;

3

Select b.owner_name,b.address,m.meter_number,bill.payable_amount
from building b 
JOIN meter m on b.id=m.building_id
JOIN bill on m.id=bill.meter_id
where bill.fine_amount is null and bill.month=12 and bill.year=2017
order by b.owner_name;

4

SELECT b.owner_name, b.address, m.meter_number, bill.payable_amount
FROM building b
INNER JOIN meter m ON b.id = m.building_id
INNER JOIN bill ON m.id = bill.meter_id
WHERE bill.fine_amount = (SELECT MAX(fine_amount) FROM bill)
ORDER BY b.owner_name ASC;

5

SELECT b.owner_name, SUM(payable_amount) AS TotalBillAmount
FROM building b
JOIN meter m ON b.id = m.building_id
JOIN bill bi ON m.id = bi.meter_id
WHERE year = 2017
GROUP BY b.owner_name
ORDER BY TotalBillAmount DESC, b.owner_name ASC
LIMIT 1;


6

Select b.owner_name, bt.name, m.meter_number,
       IF(bill.is_payed = 1,  bill.payment_date,'Not Paid Yet') AS Payment_Status
FROM building b
INNER JOIN building_type bt ON b.building_type_id = bt.id
INNER JOIN meter m ON b.id = m.building_id
INNER JOIN bill ON m.id = bill.meter_id
WHERE bill.month = 12 AND bill.year = 2017
ORDER BY b.owner_name ASC;


7

SELECT building_type.name AS building_type_name, COUNT(*) AS number_of_buildings
FROM building
INNER JOIN building_type ON building.building_type_id = building_type.id
GROUP BY building_type.name
HAVING COUNT(*) = (
  SELECT COUNT(*) AS building_count
  FROM building
  GROUP BY building_type_id
  ORDER BY building_count DESC
  LIMIT 1
)
ORDER BY building_type_name ASC;


8

SELECT m.meter_number, b.owner_name, b.address
FROM building b
JOIN meter m ON b.id = m.building_id
JOIN bill bl ON m.id = bl.meter_id
WHERE bl.fine_amount > 0
GROUP BY b.owner_name
ORDER BY COUNT(bl.fine_amount) DESC, b.owner_name ASC
LIMIT 1;


9

SELECT m.meter_number, b.owner_name, b.address
FROM meter m
JOIN building b ON m.building_id = b.id
JOIN bill bi ON m.id = bi.meter_id
WHERE bi.fine_amount != 0
ORDER BY bi.fine_amount ASC
LIMIT 1 OFFSET 1;

10

select m.meter_number , sum(er.total_units) as month_total_unit , b.payable_amount , 
sum(er.h6+er.h7+er.h8+er.h9+er.h10+er.h11) as morning , 
sum(er.h12+er.h13+er.h14+er.h15) as afternoon,
sum(er.h16+er.h17+er.h18+er.h19) as evening,
sum(er.h20+er.h21+er.h22+er.h23+er.h24+er.h1+er.h2+er.h3+er.h4+er.h5) as night
from electricity_reading er 
join meter m on m.id= er.meter_id
join bill b on b.meter_id=m.id
where b.month = 12 and b.year=2017 
group by m.meter_number
order by month_total_unit desc;
